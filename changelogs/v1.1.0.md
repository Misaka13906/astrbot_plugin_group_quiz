# v1.1.0 更新日志

**更新日期**：2026-02-19

## ✨ 新特性

- **多策略推送支持**：引入为了满足不同群组需求的推送策略系统。
    - **Counter (计数)**：优先推送推送次数最少的题目，确保所有题目都能被均匀覆盖。
    - **Batch (批次)**：按顺序分批推送题目，完成后自动进入下一批（经典模式）。
    - **DateRem (日期取余)**：根据日期循环推送题目，适合固定周期的复习计划。
- **策略管理指令**：
    - `/lstra`：查看当前群组各领域的推送策略及进度。
    - `/stra set <策略名> <all/领域名>`：切换群组指定领域或所有领域的推送策略。
    - `/stra info <领域名>`：查看指定领域的详细策略状态。
    - `/stra reset <领域名>`：重置指定领域的推送进度。

## 🛠️ 代码重构与优化

- **架构升级**：
    - **Repository 模式**：将原有的 `database.py` 重构为 `repository` 包，职责分离更清晰。
        - `core`: 数据库连接与基础与原子操作。
        - `baseinfo`: 群组、领域、用户等基础信息管理。
        - `problem`: 题目查询与检索。
        - `task`: 任务配置与状态管理。
    - **Handler 分层**：将 `commands.py` 拆分为 `handlers` 包，按功能模块组织代码。
        - `query`: 查询类指令 (`/lgroup`, `/ltask` 等)。
        - `user`: 用户交互指令 (`/ans`, `/prob` 等)。
        - `admin`: 管理员指令 (`/task` 等)。
        - `strategy`: 策略管理指令 (`/stra` 等)。

---

**升级注意**：本次更新包含数据库结构变更，请确保在更新前备份数据文件 `data/plugin_data/astrbot_plugin_group_quiz/quiz.db`。

更新需要运行：
```sql
ALTER TABLE group_task_config
ADD COLUMN strategy_type TEXT DEFAULT 'batch'
CHECK(strategy_type IN ('counter', 'batch', 'daterem'));
```
其他数据库更改已在 schema.sql 中，会自动生效

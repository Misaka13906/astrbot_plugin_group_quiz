# AstrBot 群聊答题插件 📚

> 轻量级的技术题目推送插件，专为技术学习小组设计

## ✨ 功能特性

- 📅 **定时推送**：按领域自动推送技术题目，支持批次管理
- 👥 **小组管理**：加入/退出不同技术领域小组，接收专属推送
- 🎲 **随机抽题**：手动随机获取题目，随时练习
- 📖 **答案查询**：快速查看题目参考答案
- ⚙️ **灵活配置**：管理员可自定义推送时间和领域
- 🔄 **智能循环**：题库推送完自动循环，持续学习

## 文档链接目录
- [产品设计文档](docs/design-1.0.0.md)

---
## 📋 目录

- [功能特性](#-功能特性)
- [文档链接目录](#-文档链接目录)
- [快速开始](#-快速开始)
  - [管理员首次部署](#管理员首次部署（必需）)
  - [用户基础操作](#用户基础操作)
- [完整命令列表](#-完整命令列表)
- [推送系统说明](#-推送系统说明)
- [批次管理](#-批次管理)
- [配置说明](#-配置说明)
- [数据库结构](#-数据库结构)
- [常见问题](#-常见问题)
- [更新日志](#-更新日志)

---

## 🚀 快速开始

### 管理员首次部署（必需）

插件首次启用时，数据库会自动创建表结构（`sql/schema.sql`），但**还需要手动导入数据**才能使用。

#### 步骤 1：找到数据库文件

插件启动后，数据库位于：
```
AstrBot/data/plugins/astrbot_plugin_group_quiz/quiz.db
```
对于使用docker部署的，数据库位于插件的相应挂载目录中。


#### 步骤 2：导入基础数据

使用 SQLite 命令行工具打开 `quiz.db`，然后依次执行：

**1. 导入 insert.sql（可先自己编辑）**
```
位置：sql/insert.sql
内容：创建小组和领域的基础数据
```

**2. 导入示例题目（可选）**
```
位置：sql/example.sql
内容：示例题目和配置，可根据实际需要修改
```

#### 步骤 3：自定义题目（推荐）

编辑 `sql/example.sql` 或自己编写 SQL，导入你的题目：

```sql
-- 添加题目
INSERT INTO problems (domain_id, category, topic, question, answer, score) 
VALUES (1, 'JVM', 'GC', '什么是垃圾回收？', '垃圾回收是自动内存管理...', 5);

-- 配置批次推送（可选）
INSERT INTO domain_settings (domain_id, start_index, end_index) 
VALUES (1, 1, 10);  -- Java 领域第一批：题目 1-10
```

> 💡 **提示**：
> - `domain_id` 对应 `insert.sql` 中创建的领域
> - 题目导入后会自动按 ID 排序
> - 批次配置是可选的，不配置则一次推送默认数量题目

#### 步骤 4：重启插件

数据导入完成后，在 AstrBot 管理后台重启插件即可。

---

### 用户基础操作

#### 1️⃣ 查看可用小组和领域

```
/lgroup   # 查看所有可加入的技术小组
/ldomain  # 查看所有可学习的技术领域
```

#### 2️⃣ 加入感兴趣的小组

```
/addme Java      # 加入 Java 小组
/addme Golang    # 加入 Golang 小组
/addme MySQL     # 加入 MySQL 小组
```

> 💡 加入小组后，当该小组对应领域有题目推送时，会 @ 你

#### 3️⃣ 查看我的小组

```
/mygroup         # 查看已加入的所有小组
```

#### 4️⃣ 获取题目答案

```
/ans 1           # 查看题目 1 的参考答案
/ans 42          # 查看题目 42 的参考答案
```

#### 5️⃣ 随机抽题练习

```
/rand Java       # 从 Java 领域随机抽取一道题
/rand MySQL      # 从 MySQL 领域随机抽取一道题
```

#### 6️⃣ 退出小组

```
/rmme Java       # 退出 Java 小组
```

---

## 📋 完整命令列表

### 用户命令（所有人可用）

| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/lhelp` | - | 查看帮助信息 | `/lhelp` |
| `/lgroup` | - | 列出所有可加入的小组 | `/lgroup` |
| `/ldomain` | - | 列出所有可查询的领域 | `/ldomain` |
| `/mygroup` | - | 查看我已加入的小组 | `/mygroup` |
| `/ltask` | - | 查看本群推送状态 | `/ltask` |
| `/addme` | 小组名 | 加入指定小组 | `/addme Java` |
| `/rmme` | 小组名 | 退出指定小组 | `/rmme Java` |
| `/ans` | 题目ID | 查看题目答案 | `/ans 1` |
| `/rand` | 领域名 | 随机抽取一道题 | `/rand Java` |
| `/debugconfig` | - | 查看插件配置（调试用） | `/debugconfig` |

### 管理员命令（仅群管理员可用）

| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/task on` | 领域名 时间 | 开启某领域推送 | `/task on Java 17:00` |
| `/task off` | 领域名 | 关闭某领域推送 | `/task off Java` |
| `/task on all` | 时间 | 开启所有领域推送 | `/task on all 18:00` |
| `/task off all` | - | 关闭所有领域推送 | `/task off all` |
| `/task on default` | - | 使用周推送默认配置 | `/task on default` |
| `/task off default` | - | 使用手动配置模式 | `/task off default` |

---

## 📅 推送系统说明

### 推送模式

插件支持两种推送模式：

#### 1. **周推送默认配置**（推荐）

管理员在插件配置面板中预设好每周的推送计划，群自动按计划推送。

**优点**：
- ✅ 统一管理，适合多群使用
- ✅ 每周固定时间，养成学习习惯
- ✅ 一次配置，长期有效

**启用方式**：
```
/task on default
```
查看配置：
```
/ltask
```

#### 2. **手动配置模式**

管理员通过命令为本群单独配置推送时间和领域。

**优点**：
- ✅ 灵活调整推送时间
- ✅ 按需开启/关闭特定领域
- ✅ 适合个性化需求

**配置方式**：
```
/task off default
/task on Java 17:00      # 每天 17:00 推送 Java 题目
/task on Golang 18:00    # 每天 18:00 推送 Golang 题目
/task on all 19:00       # 每天 19:00 推送所有领域题目
```

### 批次推送与循环

插件使用**智能批次系统**来管理推送进度：

- 📦 每个领域可以分多个批次（如 Java 分为基础、进阶、高级）
- 🔄 每次推送一个批次的所有题目
- ♻️ 推完所有批次后，自动循环回第一批
- 📊 每个群独立跟踪推送进度

**示例**：

假设 Java 领域配置了 3 个批次：
- 批次1：题目 1-10（基础）
- 批次2：题目 11-20（进阶）
- 批次3：题目 21-30（高级）

推送顺序：
```
第1天 → 推送批次1 (题目 1-10)
第2天 → 推送批次2 (题目 11-20)
第3天 → 推送批次3 (题目 21-30)
第4天 → 推送批次1 (题目 1-10)  ← 自动循环
```

---

## 💬 推送消息格式

### 定时推送格式

```
📅 今日八股推送 [Java]

[题目 ID: 1]
什么是JVM的内存结构？

[题目 ID: 2]
ArrayList和LinkedList的区别？

[题目 ID: 3]
什么是线程安全？

回复 /ans {id} 获取参考答案。@张三 @李四 @王五
```

> 💡 推送时会 @ 所有加入对应小组的成员

### 随机抽题格式

```
📋 随机题目 [Java] [题目 ID: 15]

Spring的IoC是什么？

回复 /ans 15 获取参考答案。
```

### 答案查询格式

```
📖 题目 15 的参考答案：

IoC(控制反转)是Spring的核心概念，将对象的创建和依赖关系的管理交给Spring容器，而不是在代码中直接new对象。通过依赖注入(DI)实现，降低代码耦合度。
```

---

## ⚙️ 管理员配置指南

### 配置周推送默认计划

插件配置**必须通过 AstrBot 的插件配置界面**进行，不要直接编辑配置文件。

1. 打开 AstrBot Web UI 管理后台
2. 进入 **插件管理** → **群聊答题插件**
3. 点击 **配置** 按钮
4. 在配置面板 UI 中配置使用默认周推送的群、每周推送计划

> 💡 **提示**：
> - 领域为空表示当天不推送
> - 时间格式为 `HH:MM`（24小时制）

配置保存后，在对应的群聊中执行：`/task on default`

验证配置是否生效：`/ltask`

应该显示：
```
📋 本群当前推送状态设置：
使用：周推送默认配置

星期一 17:00：Java、Golang
星期二 18:00：MySQL、Redis
...
```

### 常见配置问题

#### ❓ 如何查看当前配置？

在群聊中执行调试命令：
```
/debugconfig
```

会显示：
- 当前群号
- `use_default` 列表
- `settings` 配置的键
- 群号是否在列表中


### 批次配置（可选）

如果需要配置批次推送，编辑数据库中的 `domain_settings` 表：

```sql
-- Java 领域分 3 批推送
INSERT INTO domain_settings (domain_id, start_index, end_index) VALUES
(1, 1, 10),    -- 批次1
(1, 11, 20),   -- 批次2
(1, 21, 30);   -- 批次3
```

---

## 🎯 使用场景

### 场景1：技术学习小组

**背景**：大学计算机社团，每天学习不同技术领域

**配置**：
- 周一到周五：每天 17:00 推送不同领域
- 周末：暂停推送或推送综合题目

**成员操作**：
```
/addme Java      # 前端同学加入 Java 小组
/addme MySQL     # 后端同学加入 MySQL 小组
/addme 网络协议   # 网络方向同学加入网络协议小组
```

### 场景2：求职刷题群

**背景**：准备面试的同学一起刷题

**配置**：
- 每天固定时间推送高频面试题
- 覆盖多个技术领域

**成员操作**：
```
/addme Java
/addme MySQL
/addme Redis
/addme 系统设计
# 加入所有相关领域，全面准备面试
```


---

## ❓ 常见问题

### Q1: 为什么我没有收到推送？

**可能原因**：
1. 没有加入对应的小组 → 使用 `/addme 小组名` 加入
2. 该领域推送未开启 → 联系管理员使用 `/ltask` 查看状态
3. 本群未配置推送 → 管理员需配置推送时间

### Q2: 如何知道当前推送到第几批了？

**方法1**：查看推送的题目 ID
- 如果推送的是题目 11-20，说明在第二批

**方法2**：管理员可查询数据库
```sql
SELECT group_qq, domain_id, now_cursor FROM group_task_config;
```

### Q3: 可以跳过某个批次吗？

修改数据库的 now_cursor 为下一批次的 start_index 即可。

### Q4: 能否为不同群配置不同的推送内容？

可以！有两种方式：
1. **手动配置模式**：每个群单独配置推送时间和领域
2. **周配置模式**：部分群使用默认配置，其他群手动配置

### Q5: 推送时间可以设置多个吗？

每个领域每个群只能设置一个推送时间。
如果需要一天推送两次，可以：
- 配置两个不同的领域
- 或使用周配置在不同天推送相同领域

### Q6: 题目会重复推送吗？

会循环推送。批次推送完后会自动回到第一批，这样可以定期复习。

### Q7: 如何添加新的题目？

需要管理员在数据库中添加：
```sql
INSERT INTO problems (domain_id, category, topic, question, default_ans, score) 
VALUES (1, '分类', '主题', '问题内容', '答案内容', 10);
```

---

## 📚 技术领域示例

插件支持的领域包括但不限于：

- **编程语言**：Java, C++, Golang, Python
- **数据库**：MySQL, Redis, MongoDB
- **基础知识**：数据结构, 操作系统, 网络协议
- **系统架构**：分布式, 系统设计, 消息队列
- **工具技能**：Git, Linux 命令

> 具体可用领域请使用 `/ldomain` 查询

---

## 🔧 技术支持

- **问题反馈**：[GitHub Issues](https://github.com/Misaka13906/astrbot_plugin_group_quiz/issues)
- **插件仓库**：[astrbot_plugin_group_quiz](https://github.com/Misaka13906/astrbot_plugin_group_quiz)

---

## 📄 版权信息

本插件为开源项目，遵循相应的开源协议。
题目内容来源于网络整理，仅供学习交流使用。

---

## 🎉 开始使用

现在就在你的群聊中输入 `/lhelp` 开始使用吧！

> 💡 提示：建议先加入几个感兴趣的小组，然后等待定时推送，或使用 `/rand` 立即开始练习！
